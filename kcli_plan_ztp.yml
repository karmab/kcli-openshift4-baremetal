{% if lab and ztp_spoke_api_ip != None and ztp_spoke_ingress_ip != None %}
api-{{ ztp_spoke_name }}:
 type: dns
 net: {{ baremetal_net }}
 ip: {{ ztp_spoke_api_ip }}
 alias:
 - api.{{ ztp_spoke_name }}.{{ domain }}
 - api-int.{{ ztp_spoke_name }}.{{ domain }}

apps-{{ ztp_spoke_name }}:
 type: dns
 net: {{ baremetal_net }}
 ip: {{ ztp_spoke_ingress_ip }}
 alias:
 - console-openshift-console.apps.{{ ztp_spoke_name }}.{{ domain }}
 - oauth-openshift.apps.{{ ztp_spoke_name }}.{{ domain }}
 - prometheus-k8s-openshift-monitoring.apps.{{ ztp_spoke_name }}.{{ domain }}
 - canary-openshift-ingress-canary.apps.{{ ztp_spoke_name }}.{{ domain }}
 - assisted-service-open-cluster-management.apps.{{ ztp_spoke_name }}.{{ domain }}
 - assisted-service-assisted-installer.apps.{{ ztp_spoke_name }}.{{ domain }}
 - assisted-image-service-open-cluster-management.apps.{{ ztp_spoke_name }}.{{ domain }}
{% endif %}

{% if ztp_virtual_nodes %}
{% for num in range(0, ztp_virtual_nodes_number) %}
{{ cluster }}-ztp-node-{{ num }}:
 pool: {{ pool }}
 numcpus: {{ ztp_virtual_nodes_numcpus }}
 start: false
 cloudinit: false
# uefi: {{ 'true' }}
 uefi_legacy: True
 memory: {{ ztp_virtual_nodes_memory }}
 nets:
  - name: {{ baremetal_net }}
{% if baremetal_macs and baremetal_macs|length > virtual_masters_number + virtual_workers_number + num %}
    mac: {{ baremetal_macs[virtual_masters_number + virtual_workers_number + num] }}
{% else %}
    mac: {{ ztp_virtual_nodes_baremetal_mac_prefix + ":" + "%02.d" | format(num + 1)| string }}
{% endif %}
{% if lab and baremetal_ips and baremetal_ips|length > virtual_masters_number + virtual_workers_number + num %}
    ip: {{ baremetal_ips[virtual_masters_number + virtual_workers_number + num] }}
    reserveip: true
{% if ztp_virtual_nodes_number == 1 %}
    alias:
    - api.{{ ztp_spoke_name }}.{{ domain }}
    - api-int.{{ ztp_spoke_name }}.{{ domain }}
{% endif %}
{% endif %}
 disks:
 - size: {{ ztp_virtual_nodes_disk_size }}
   interface: scsi
{% endfor %}
{% endif %}

{{ cluster }}-installer:
 baseplan: kcli_plan.yml
 files:
 - ztp_assisted-service.sample.yml
 - ztp_assisted-service.sh
 - ztp_spoke.sample.yml
 - ztp_spoke.sh
 - ztp_bmc.yml
 - ztp_bmc.sh
{% if acm %}
 - acm_cr.yml
{% if acm_downstream %}
 - origin: {{ acm_pullsecret }}
   path: /root/openshift_pull_acm.json
 - acm_downstream.sh
{% endif %}
{% else %}
 - ai_install.yml
{% endif %}
 - path: /root/bin/gen_registries.py
   origin: helpers/gen_registries.py
{% if 'ztp_spoke_manifests'|find_manifests %}
 - ztp_spoke_manifests.sh
 - ztp_spoke_manifests
 - ztp_spoke_manifests.yml
{% endif %}
 scripts:
{% if deploy_openshift %}
 - ztp_assisted-service.sh
{% if ztp_spoke_deploy %}
 - ztp_spoke.sh
{% endif %}
{% endif %}
